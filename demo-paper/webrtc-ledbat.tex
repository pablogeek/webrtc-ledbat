\documentclass{sig-alternate}
%
%\usepackage{makeidx}  % allows for indexgeneration
%\usepackage[pdftex]{graphicx}\usepackage{graphicx}
\usepackage{float}
\usepackage{subfig}
\usepackage{caption}
\DeclareCaptionType{copyrightbox}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{algorithm,algorithmicx}
\usepackage{algpseudocode}

\begin{document}
%\normalem


\title{Why so aggressive? Low Extra Delay Backround Traffic (LEDBAT) in WebRTC}

\numberofauthors{3}

\author{
\alignauthor
Riccardo Reale\\
      \affaddr{Peerialism AB, Stockholm, Sweden}\\
      \email{riccardo@peerialism.com}
\alignauthor
Anton Blomberg\\
      \affaddr{Stockholm University, Stockholm, Sweden}\\
      \email{anton@naetet.se}
\alignauthor
Roberto Roverso\\
      \affaddr{Peerialism AB, Stockholm, Sweden}\\
      \email{roberto@peerialism.com}
}

\newcommand{\mysec}[1]{\vspace*{-0.0cm}\section{#1}}
\newcommand{\mysubsec}[1]{\vspace*{-0.0cm}\subsection{#1}\vspace*{0cm}}
\newcommand{\mysubsubsec}[1]{\vspace*{-0.0cm}\subsubsection{#1}\vspace*{0cm}}
\newcommand{\mypar}[1]{\vspace*{-0cm}\paragraph{#1}\vspace*{0cm}}

\maketitle
%\vspace*{-1cm}

\begin{abstract}
  In this paper, we present what is, to the best of our knowledge, the first
  implementation of LEDBAT for the WebRTC framework. In particular, we detail how we
  integrated the protocol in the WebRTC stack in a way that features such as encryption
  and NAT Traversal could also be applied to LEDBAT transfers and not only to the existing
  transfer protocol (SCTP). We also include preliminary results of this effort that show
  the correct functioning of our implementation.
\end{abstract}

\category{C.2.2}{Computer-Communication Networks}{Network Protocols}
\category{C.2.4}{Computer-Communication Networks}{Distributed Systems}
\terms{Experimentation, Performance, Measurement}
\keywords{LEDBAT, WebRTC, Peer-to-peer}

\mysec{Introduction}
% WebRTC general 
Recently, WebRTC has been steadily gaining popularity fueled by the inclusion in most of
the browsers on the market. The WebRTC standard mandates the multimedia and peer-to-peer
connectivity stacks for real-time services, once provided by external plugins, to be built
directly into the browser. That means that the functionality of those stacks, such as
video acquisition, noise cancelling and NAT traversal, is directly available through
Javascript and HTML5 APIs. Although WebRTC has been mainly designed as a framework to
facilitate video and audio conferencing, it does include support for building other types
of peer-to-peer applications, such as CDN accellerators~\cite{peerCDN} and video streaming
platforms~\cite{nurminen2013p2p}. This feature is provided through the DataChannel
abstraction, which allows the transfer of arbitrary data over encrypted connections
established with WebRTC's NAT traversal facilities. The DataChannel API make use of the
Stream Control Transfer protocol (SCTP)~\cite{sctp} protocol in order to manage data
transfers. SCTP is message-oriented protocol and provides a variety of options on data
transfer to accomodate the needs of different types of applications. When setting up a
DataChannel, WebRTC applications may choose in- or out-of-order delivery, reliable or
unreliable delivery and have a specific priority level on the channel. Regarding
congestion control, the latest version of SCTP included in WebRTC make use of the same
congestion control found in H-TCP~\cite{htcp}. The main characteristic of H-TCP is that it
delivers the same priority as TCP in low bandwidth networks while trying to better exploit
High Delay-Bandwidth Product links always compared to TCP.

% Why LEDBAT is important
Although the DataChannel implementation currently provides very useful features, it lacks
a fundamental component that is background traffic. This is usually provided in P2P
network stacks by a delay-based congestion control protocol such as LEDBAT~\cite{ledbat}. 
LEDBAT achieves low priority behaviour by completely yielding to other TCP traffic on the same
network and by keeping the delay on a link fixed to a low and constant target. By adopting
such protocol, data-intensive applications such as Bittorrent avoid disrupting both
TCP-based web browsing and low delay VoIP applications. Low priority traffic is also a
vital requirement for other types of applications, such as streaming
platforms ~\cite{smoothcache}\cite{roberto-thesis}.

% What we did 
In this paper, we present what is, to the best of our knowledge, the first implementation
of LEDBAT for the WebRTC framework. In particular, we detail how we integrated the
protocol in the WebRTC stack such that features like encryption and NAT traversal could also 
be applied to LEDBAT transfers and not only to SCTP. We also include
preliminary results of this effort that show the correct functioning of our
implementation.

% Open source
The implementation is open-source and can be found at~\cite{webrtc-utp}. We hope that, by
adding LEDBAT to WebRTC, we will enable the creation of a new class of data-intensive
web-based P2P applications. Those, will be able to coexist with standard web browsing and
the typical application of WebRTC, which is conferencing.



\begin{figure}[t]
  \centering
    \includegraphics[width=0.46\textwidth]{figs/architecture2}
\vspace*{-0.38cm}
	\caption{WebRTC protocol stack} \label{fig:architecture}
\vspace*{-0.4cm}
\end{figure}

\mysec{LEDBAT in WebRTC}

% - how SCTP work
%The main reason why SCTP was chosen as application level transport protocol for the DataChannel is that it natively support some interesting features such as configurable in-order delivery, configurable reliability and a channel priority level defined by the application. Moreover it provides flow control and congestion control, while security is ensured by tunnelling all the traffic through a secure DTLS session, which itself run on top of UDP.
The current version of WebRTC's DataChannel incorporates a user-level SCTP
implementaion~\footnote{http://url-of-sctp-implementation} written in \textit{C} and built
on top of UDP. SCTP interfaces with a security layer, that is DTLS, which adds security
and integrity to all traffic sent through a DataChannel session.  All data sent through
that session is carried over connnections that have been established using the ICE NAT
Traversal protocol, that is last layer of the WebRTC protocol stack.

% - what we changed
In order to implement LEDBAT support in WebRTC, we opted to directly integrate the
\textit{uTP} library \cite{utp-repo} in the WebRTC protocol stack as an optional
alternative to SCTP. uTP is the reference open-source implementation of LEDBAT and is
provided by the Bittorrent. Similarly to SCTP, uTP provides reliability, in-order delivery
and it is layerd over UDP. Given the similarities between the protocols, we were able to
easily integrate uTP with the existing WebRTC stack. That, by developing a translation
layer that interpret API requests from the DataChannel layer for the uTP layer. Besides
that, we modified the DataChannel API to be able to choose between SCTP and uTP as
transport protocol when setting up a data channel. The resulting structure of the WebRTC
stack is shown in Figure \ref{fig:architecture}. Finally, we were able to channel all data
processed by the uTP implementation into the DTLS processing.

% - shortcomings

\label{sec:architecture}

\mysec{Preliminary results}

% - setup
We conducted a preliminary evaluation of our solution in a controlled network environment
consisting of two host machines, a sender and a receiver, running Linux Ubuntu with kernel
3.11.0-12 connected through a 100 Mbit/s link. We used Dummynet on the sender host,
configured to cap the outgoing traffic to 1Mbps, with 100 ms base delay and 60KB of queue
buffer to simulate a typical WAN gateway scenario. 

In order to test our implementation, we developed a test application in \textit{C} that
generates traffic using directly the WebRTC Native DataChannel API to emulate the traffic
generated by a data-intensive browser application. Our test applicaiton can be configured
to initialize either a STCP DataChannel, or a LEDBAT DataChannel.

Both hosts run our test application and a separate TCP traffic generator to obtain traffic
competing on the same network resources. TCP file transfer uses TCP Cubic, the default
Linux congestion control. Finally, a third host acts as a server to handle the WebRTC
session signalling between the sender and the receiver.

% - metrics
As metrics, we utilize the throughput of the DataChannel LEDBAT transfers, when competing
against TCP traffic, and the Round Trip Time (RTT) measured on the link. With these two
metrics, we verify that LEDBAT transfers for indeed yeild to TCP and, at the same time, we
evaluate the relative increase on the one-way delay, which directly affects latency and,
therefore, web browsing responsiveness.

% - evaluation
Figure \ref{fig:2ledbat_tcp} shows the throughput evolution of two DataChannel LEDBAT
streams and a single TCP stream, starting at 60 seconds from each other. The corresponding
Round Trip Time is also shown above. The two LEDBAT flows, as expected, utilize all
available bandwidth, until they quickly and completely release the bottleneck in favour of
the higher priority TCP flow. The increase in the RTT due to the presence of LEDBAT flows
is limited to 100 millisecond, which is the default target delay configuration in
uTP. Note that the number of LEDBAT streams doesn't affect the amount of extra delay
introduced.

%During the initial two minutes of the experiment, the LEDBAT streams correctly use all the available network resources while maintaining the introduced extra delay to a maximum of 100 millisecond, correspondent to the default target delay configured in uTP. At second 120 the two streams quickly release resources in favour of the higher priority TCP flow until it terminates. 

For direct comparison and validation that the normal behavior od SCTP was not affected,
Figure \ref{fig:2sctp_tcp} shows the same experiment performed configuring our test
application to use DataChannel SCTP streams. Besides fairly sharing the link with the TCP
transfer as expected, each of the SCTP streams introduce a large amount of extra-delay on
the link as TCP does.

\begin{figure}[t]
  \centering
    \includegraphics[width=0.47\textwidth]{figs/2ledbat_tcp}
\vspace*{-0.38cm}
	\caption{Two DataChannel LEDBAT streams sharing a 1Mbit/s bottleneck with a TCP stream} \label{fig:2ledbat_tcp}
\vspace*{-0.4cm}
\end{figure}

\begin{figure}[t]
  \centering
    \includegraphics[width=0.47\textwidth]{figs/2sctp_tcp}
\vspace*{-0.38cm}
	\caption{Two DataChannel SCTP  streams sharing a 1Mbit/s bottleneck with a TCP stream} \label{fig:2sctp_tcp}
\vspace*{-0.4cm}
\end{figure}

\bibliographystyle{abbrv}
\bibliography{main}


\end{document}
